/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var O=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var H=Object.prototype.hasOwnProperty;var Q=(r,t)=>{for(var e in t)O(r,e,{get:t[e],enumerable:!0})},X=(r,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of W(t))!H.call(r,o)&&o!==e&&O(r,o,{get:()=>t[o],enumerable:!(i=J(t,o))||i.enumerable});return r};var Z=r=>X(O({},"__esModule",{value:!0}),r);var et={};Q(et,{default:()=>F});module.exports=Z(et);var u=require("obsidian");var B={recordingFolder:"vmemo-recordings",keepAudioFiles:!0,audioFormat:"wav",voxmlxPath:"",voxmlxModel:"mlx-community/Voxtral-Mini-4B-6bit",transcriptionLanguage:"auto",aiProvider:"anthropic",autoFormat:!0,anthropicKey:"",anthropicModel:"claude-sonnet-4-20250514",openaiKey:"",openaiModel:"gpt-4.1",googleKey:"",googleModel:"gemini-2.5-pro",xaiKey:"",xaiModel:"grok-3",defaultTemplate:"meeting-notes",customTemplates:{},maxRecordingDuration:120,showNotifications:!0,debugMode:!1},a={anthropic:{model:"claude-sonnet-4-20250514",name:"Claude Sonnet 4",endpoint:"https://api.anthropic.com/v1/messages",maxTokens:8192},openai:{model:"gpt-4.1",name:"GPT-4.1",endpoint:"https://api.openai.com/v1/chat/completions",maxTokens:8192},google:{model:"gemini-2.5-pro",name:"Gemini 2.5 Pro",endpoint:"https://generativelanguage.googleapis.com/v1beta/models",maxTokens:8192},xai:{model:"grok-3",name:"Grok 3",endpoint:"https://api.x.ai/v1/chat/completions",maxTokens:8192}},U={sampleRate:16e3,channelCount:1,bitDepth:16,mimeType:"audio/webm;codecs=opus",targetFormat:"wav",maxFileSizeMB:500},g={voxmlxCommand:"voxmlx",checkCommand:"voxmlx --version",installCommand:"pipx install voxmlx --python python3.11",pythonVersion:"3.11",supportedFormats:["wav","mp3","m4a","flac","ogg","webm"],defaultLanguage:"auto"},d={"meeting-notes":{id:"meeting-notes",name:"Meeting Notes",description:"Structured meeting minutes with action items",icon:"users",content:`# Meeting Notes: {{title}}

**Date**: {{date}}
**Time**: {{time}}
**Duration**: {{duration}}
**Participants**: {{speakerCount}} speakers

---

## Summary

{{summary}}

## Discussion Points

{{content}}

## Action Items

- [ ] 

## Decisions Made

- 

## Next Steps

- 

---

*Recorded with VMemo*
*Audio: [[{{audioPath}}]]*`,systemPrompt:`You are an expert meeting note formatter. Transform the transcript into well-structured meeting notes.

Your responsibilities:
1. Create a concise executive summary (2-3 sentences)
2. Organize discussion points by topic with clear headers
3. Extract and list all action items with assignees if mentioned
4. Identify and document key decisions made
5. Suggest logical next steps based on the discussion
6. Clean up filler words and verbal tics
7. Fix grammar and improve readability

Format with Markdown:
- Use ## for major sections
- Use ### for subsections
- Use bullet points for lists
- Use checkboxes for action items
- Bold important terms and names

Keep the original meaning and tone. Do not add information not present in the transcript.`},"lecture-notes":{id:"lecture-notes",name:"Lecture Notes",description:"Educational content with key concepts and summaries",icon:"graduation-cap",content:`# Lecture: {{title}}

**Date**: {{date}}
**Duration**: {{duration}}
**Subject**: 

---

## Key Concepts

{{summary}}

## Detailed Notes

{{content}}

## Important Terms

- 

## Questions to Review

- 

## Related Topics

- 

---

*Recorded with VMemo*
*Audio: [[{{audioPath}}]]*`,systemPrompt:`You are an expert educational content formatter. Transform the lecture transcript into comprehensive study notes.

Your responsibilities:
1. Identify and highlight key concepts and main ideas
2. Organize content into logical learning sections
3. Extract important terminology and definitions
4. Create review questions based on the content
5. Suggest related topics for further study
6. Clean up verbal fillers and improve readability
7. Preserve technical accuracy and nuance

Format with Markdown:
- Use ## for major topics
- Use ### for subtopics
- Use bullet points for lists
- Use **bold** for key terms
- Use > blockquotes for important quotes or definitions

Optimize for learning and review. Maintain academic rigor.`},interview:{id:"interview",name:"Interview Notes",description:"Q&A format with candidate evaluation",icon:"message-circle",content:`# Interview: {{title}}

**Date**: {{date}}
**Duration**: {{duration}}
**Participants**: {{speakerCount}}

---

## Overview

{{summary}}

## Questions & Answers

{{content}}

## Key Observations

- 

## Strengths

- 

## Areas for Follow-up

- 

## Overall Assessment

---

*Recorded with VMemo*
*Audio: [[{{audioPath}}]]*`,systemPrompt:`You are an expert interview documenter. Transform the interview transcript into structured Q&A notes.

Your responsibilities:
1. Clearly separate questions from answers
2. Identify the interviewer and interviewee
3. Highlight key responses and notable quotes
4. Note any follow-up questions or clarifications
5. Extract observable skills and qualities
6. Maintain objectivity and accuracy
7. Clean up filler words while preserving meaning

Format with Markdown:
- Use **Q:** and **A:** prefixes for dialogue
- Use ### for topic transitions
- Use bullet points for observations
- Use > blockquotes for notable responses

Preserve the authentic voice of the interviewee. Be objective and thorough.`},brainstorm:{id:"brainstorm",name:"Brainstorm Session",description:"Ideas and creative concepts organized by theme",icon:"lightbulb",content:`# Brainstorm: {{title}}

**Date**: {{date}}
**Duration**: {{duration}}
**Participants**: {{speakerCount}}

---

## Session Goal

{{summary}}

## Ideas Generated

{{content}}

## Top Ideas to Explore

1. 
2. 
3. 

## Action Items

- [ ] 

## Parking Lot (Future Ideas)

- 

---

*Recorded with VMemo*
*Audio: [[{{audioPath}}]]*`,systemPrompt:`You are an expert creative session facilitator. Transform the brainstorm transcript into organized idea documentation.

Your responsibilities:
1. Capture ALL ideas mentioned, even incomplete ones
2. Group related ideas by theme or category
3. Identify the most promising or frequently discussed ideas
4. Note any constraints or concerns raised
5. Extract action items for follow-up
6. Preserve creative energy and spontaneity
7. Clean up while maintaining idea essence

Format with Markdown:
- Use ## for idea categories
- Use numbered lists for ranked ideas
- Use bullet points for idea details
- Use \u{1F4A1} emoji for breakthrough ideas
- Use \u26A0\uFE0F for concerns or constraints

Capture the creative spirit. Every idea has potential value.`},journal:{id:"journal",name:"Voice Journal",description:"Personal reflection and daily thoughts",icon:"book-open",content:`# Journal Entry

**Date**: {{date}}
**Time**: {{time}}
**Duration**: {{duration}}

---

## Today's Thoughts

{{content}}

## Reflections

{{summary}}

## Gratitude

- 

## Tomorrow's Intentions

- 

---

*Voice journal powered by VMemo*`,systemPrompt:`You are a thoughtful journal assistant. Transform the voice journal into a reflective written entry.

Your responsibilities:
1. Preserve the personal, authentic voice
2. Organize thoughts into coherent paragraphs
3. Identify themes and patterns in the reflection
4. Extract any goals or intentions mentioned
5. Note any gratitude or positive observations
6. Gently improve readability without losing intimacy
7. Maintain privacy and sensitivity

Format with Markdown:
- Use flowing paragraphs for narrative sections
- Use bullet points for lists
- Use *italics* for inner thoughts
- Use > blockquotes for memorable realizations

This is personal writing. Preserve authenticity and emotional truth.`},raw:{id:"raw",name:"Raw Transcript",description:"Unformatted transcript with minimal cleanup",icon:"file-text",content:`# Transcript: {{title}}

**Date**: {{date}} {{time}}
**Duration**: {{duration}}
**Language**: {{language}}

---

{{content}}

---

*Transcribed with VMemo using voxmlx*
*Audio: [[{{audioPath}}]]*`,systemPrompt:`You are a transcript cleaner. Make minimal improvements to the raw transcript.

Your responsibilities:
1. Add proper punctuation and capitalization
2. Fix obvious speech recognition errors
3. Add paragraph breaks at natural pauses
4. Keep ALL content - do not summarize or remove anything
5. Do not add headers or structure
6. Do not interpret or expand on content

Output the cleaned transcript as continuous text with paragraph breaks.
This should remain as close to verbatim as possible.`}},h={statusBarUpdateInterval:1e3,notificationDuration:5e3,progressUpdateInterval:500,ribbonIconId:"vmemo-ribbon-icon",statusBarClass:"vmemo-status-bar"},p={microphonePermissionDenied:"Microphone access denied. Please allow microphone permission in your browser settings.",noMicrophoneFound:"No microphone found. Please connect an audio input device.",recordingFailed:"Recording failed. Please try again.",maxDurationReached:"Maximum recording duration reached.",voxmlxNotInstalled:"voxmlx is not installed. Would you like to install it now?",voxmlxInstallFailed:"Failed to install voxmlx. Please install manually: pipx install voxmlx --python python3.11",pythonNotFound:"Python 3.11+ not found. Please install Python first.",transcriptionFailed:"Transcription failed. Please check the audio file and try again.",apiKeyMissing:r=>`${r} API key not configured. Please add your API key in settings.`,apiRequestFailed:r=>`${r} API request failed. Please check your API key and try again.`,rateLimitExceeded:"API rate limit exceeded. Please wait a moment and try again.",fileNotFound:"File not found.",fileReadError:"Failed to read file.",fileWriteError:"Failed to write file.",invalidAudioFormat:"Invalid audio format. Supported formats: WAV, MP3, M4A, FLAC, OGG, WebM."};var x=class{constructor(){this.mediaRecorder=null;this.audioChunks=[];this.stream=null}async start(){if(this.mediaRecorder)throw new Error("Recording already in progress");this.stream=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:U.sampleRate,channelCount:U.channelCount,echoCancellation:!0,noiseSuppression:!0}}),this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:this.getSupportedMimeType()}),this.audioChunks=[],this.mediaRecorder.ondataavailable=t=>{t.data.size>0&&this.audioChunks.push(t.data)},this.mediaRecorder.start(1e3)}async stop(){return new Promise((t,e)=>{if(!this.mediaRecorder){e(new Error("No recording in progress"));return}this.mediaRecorder.onstop=()=>{let i=this.getSupportedMimeType(),o=new Blob(this.audioChunks,{type:i});this.cleanup(),t(o)},this.mediaRecorder.onerror=()=>{this.cleanup(),e(new Error("Recording error occurred"))},this.mediaRecorder.stop()})}isRecording(){var t;return((t=this.mediaRecorder)==null?void 0:t.state)==="recording"}getSupportedMimeType(){let t=["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/mp4"];for(let e of t)if(MediaRecorder.isTypeSupported(e))return e;return"audio/webm"}cleanup(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.mediaRecorder=null,this.audioChunks=[]}};var q=require("child_process"),Y=require("util"),z=require("obsidian");var G=require("child_process"),j=require("util"),T=require("obsidian");var P=(0,j.promisify)(G.exec),b=class{constructor(t){this.plugin=t}async checkInstallation(){try{let t=this.plugin.settings.voxmlxPath||g.voxmlxCommand;return await P(`${t} --version`),!0}catch(t){return!1}}async install(){new T.Notice("Installing voxmlx... This may take a few minutes.");try{await this.checkPython(),await this.installVoxmlx(),new T.Notice("voxmlx installed successfully!")}catch(t){let e=t instanceof Error?t.message:p.voxmlxInstallFailed;throw new T.Notice(`Installation failed: ${e}`,1e4),t}}async checkPython(){try{let{stdout:t}=await P("python3 --version"),e=t.match(/Python (\d+)\.(\d+)/);if(!e)throw new Error(p.pythonNotFound);let i=parseInt(e[1]),o=parseInt(e[2]);if(i<3||i===3&&o<11)throw new Error("Python 3.11+ is required for voxmlx")}catch(t){throw t instanceof Error&&t.message.includes("Python")?t:new Error(p.pythonNotFound)}}async installVoxmlx(){let{stdout:t,stderr:e}=await P(g.installCommand,{timeout:3e5});if(e&&!e.includes("Successfully installed")&&!e.includes("already installed")&&console.warn("voxmlx install stderr:",e),!await this.checkInstallation())throw new Error(p.voxmlxInstallFailed)}async getVersion(){try{let t=this.plugin.settings.voxmlxPath||g.voxmlxCommand,{stdout:e}=await P(`${t} --version`);return e.trim()}catch(t){return null}}};var tt=(0,Y.promisify)(q.exec),I=class{constructor(t){this.plugin=t,this.installer=new b(t)}async transcribe(t){var o;await this.ensureVoxmlxInstalled();let e=this.getAbsolutePath(t),i=Date.now();try{let n=await this.runVoxmlx(e),s=Date.now()-i;return{text:n.text,duration:n.duration||0,language:n.language||"unknown",speakerCount:((o=n.speakers)==null?void 0:o.length)||1,segments:n.segments||[],metadata:{model:this.plugin.settings.voxmlxModel,processingTime:s,audioPath:t,timestamp:new Date}}}catch(n){let s=n instanceof Error?n.message:"Unknown error";throw new Error(`Transcription failed: ${s}`)}}async ensureVoxmlxInstalled(){await this.installer.checkInstallation()||(new z.Notice("voxmlx not found. Attempting to install..."),await this.installer.install())}getAbsolutePath(t){var i,o;return`${((o=(i=this.plugin.app.vault.adapter).getBasePath)==null?void 0:o.call(i))||""}/${t}`}async runVoxmlx(t){let i=`${this.plugin.settings.voxmlxPath||g.voxmlxCommand} --audio "${t}"`;try{let{stdout:o,stderr:n}=await tt(i,{timeout:6e5,maxBuffer:52428800});return n&&!n.includes("Loading")&&!n.includes("Processing")&&console.warn("voxmlx stderr:",n),this.parseOutput(o)}catch(o){throw o instanceof Error&&o.message.includes("ETIMEDOUT")?new Error("Transcription timed out. The audio file may be too long."):o}}parseOutput(t){try{return JSON.parse(t)}catch(e){return{text:t.trim(),duration:0,language:"unknown",segments:[]}}}};var c=class{constructor(t){this.maxRetries=3;this.retryDelayMs=1e3;this.plugin=t}async withRetry(t,e=1){try{return await t()}catch(i){if(e>=this.maxRetries)throw i;let o=this.retryDelayMs*Math.pow(2,e-1);return await this.sleep(o),this.withRetry(t,e+1)}}sleep(t){return new Promise(e=>setTimeout(e,t))}handleApiError(t,e){var n;let i=e,o=((n=i.error)==null?void 0:n.message)||i.message||"Unknown API error";throw t.status===401?new Error("Invalid API key"):t.status===429?new Error("Rate limit exceeded. Please try again later."):t.status>=500?new Error("Provider server error. Please try again."):new Error(`API Error: ${o}`)}};var A=class extends c{get providerType(){return"anthropic"}isConfigured(){return!!this.plugin.settings.anthropicKey}async complete(t){return this.withRetry(async()=>{var s,m;let e=this.plugin.settings.anthropicModel||a.anthropic.model,i=t.maxTokens||a.anthropic.maxTokens,o=await fetch(a.anthropic.endpoint,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.plugin.settings.anthropicKey,"anthropic-version":"2024-01-01"},body:JSON.stringify({model:e,max_tokens:i,system:t.systemPrompt,messages:[{role:"user",content:t.userPrompt}]})}),n=await o.json();return o.ok||this.handleApiError(o,n),{content:n.content[0].text,model:n.model,usage:{inputTokens:((s=n.usage)==null?void 0:s.input_tokens)||0,outputTokens:((m=n.usage)==null?void 0:m.output_tokens)||0}}})}};var S=class extends c{get providerType(){return"openai"}isConfigured(){return!!this.plugin.settings.openaiKey}async complete(t){return this.withRetry(async()=>{var s,m;let e=this.plugin.settings.openaiModel||a.openai.model,i=t.maxTokens||a.openai.maxTokens,o=await fetch(a.openai.endpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.plugin.settings.openaiKey}`},body:JSON.stringify({model:e,max_tokens:i,messages:[{role:"system",content:t.systemPrompt},{role:"user",content:t.userPrompt}]})}),n=await o.json();return o.ok||this.handleApiError(o,n),{content:n.choices[0].message.content,model:n.model,usage:{inputTokens:((s=n.usage)==null?void 0:s.prompt_tokens)||0,outputTokens:((m=n.usage)==null?void 0:m.completion_tokens)||0}}})}};var M=class extends c{get providerType(){return"google"}isConfigured(){return!!this.plugin.settings.googleKey}async complete(t){return this.withRetry(async()=>{var v,w,f,y,$,_,K;let e=this.plugin.settings.googleModel||a.google.model,i=t.maxTokens||a.google.maxTokens,o=`${a.google.endpoint}/${e}:generateContent?key=${this.plugin.settings.googleKey}`,n=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({system_instruction:{parts:[{text:t.systemPrompt}]},contents:[{parts:[{text:t.userPrompt}]}],generationConfig:{maxOutputTokens:i}})}),s=await n.json();return n.ok||this.handleApiError(n,s),{content:(($=(y=(f=(w=(v=s.candidates)==null?void 0:v[0])==null?void 0:w.content)==null?void 0:f.parts)==null?void 0:y[0])==null?void 0:$.text)||"",model:e,usage:{inputTokens:((_=s.usageMetadata)==null?void 0:_.promptTokenCount)||0,outputTokens:((K=s.usageMetadata)==null?void 0:K.candidatesTokenCount)||0}}})}};var R=class extends c{get providerType(){return"xai"}isConfigured(){return!!this.plugin.settings.xaiKey}async complete(t){return this.withRetry(async()=>{var s,m;let e=this.plugin.settings.xaiModel||a.xai.model,i=t.maxTokens||a.xai.maxTokens,o=await fetch(a.xai.endpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.plugin.settings.xaiKey}`},body:JSON.stringify({model:e,max_tokens:i,messages:[{role:"system",content:t.systemPrompt},{role:"user",content:t.userPrompt}]})}),n=await o.json();return o.ok||this.handleApiError(o,n),{content:n.choices[0].message.content,model:n.model,usage:{inputTokens:((s=n.usage)==null?void 0:s.prompt_tokens)||0,outputTokens:((m=n.usage)==null?void 0:m.completion_tokens)||0}}})}};var k=class{constructor(t){this.plugin=t,this.providers=new Map([["anthropic",new A(t)],["openai",new S(t)],["google",new M(t)],["xai",new R(t)]])}async format(t,e){var f,y;let i=this.getActiveProvider(),o=this.getTemplate(e),n=Date.now(),s=await i.complete({systemPrompt:o.systemPrompt,userPrompt:this.buildUserPrompt(t,e)}),m=this.extractSummary(s.content),v=this.extractActionItems(s.content),w=this.extractDecisions(s.content);return{content:s.content,title:this.generateTitle(s.content),summary:m,actionItems:v,decisions:w,metadata:{provider:i.providerType,model:s.model,template:e,tokensUsed:(((f=s.usage)==null?void 0:f.inputTokens)||0)+(((y=s.usage)==null?void 0:y.outputTokens)||0),processingTime:Date.now()-n}}}getActiveProvider(){let t=this.plugin.settings.aiProvider,e=this.providers.get(t);if(!e)throw new Error(`Unknown provider: ${t}`);if(!e.isConfigured())throw new Error(p.apiKeyMissing(t));return e}getTemplate(t){let e=d[t];if(e)return{systemPrompt:e.systemPrompt,content:e.content};let i=this.plugin.settings.customTemplates[t];return i?{systemPrompt:i.systemPrompt||d["meeting-notes"].systemPrompt,content:i.content}:{systemPrompt:d["meeting-notes"].systemPrompt,content:d["meeting-notes"].content}}buildUserPrompt(t,e){let i=d[e];return`Please format the following voice transcript into a well-structured ${(i==null?void 0:i.name)||"document"}:

---
TRANSCRIPT:
${t}
---

Remember to:
- Clean up filler words (um, uh, like, you know)
- Fix grammar and punctuation
- Add logical section headers
- Extract action items and decisions if applicable
- Maintain the original meaning and important details`}generateTitle(t){let e=t.split(`
`).find(o=>o.trim().startsWith("#"));if(e)return e.replace(/^#+\s*/,"").slice(0,100);let i=t.split(/[.!?]/)[0];return i&&i.length<=100?i.trim():"Untitled Document"}extractSummary(t){var i;let e=t.match(/##\s*(?:Summary|Overview|요약)\s*\n([\s\S]*?)(?=\n##|$)/i);return(i=e==null?void 0:e[1])==null?void 0:i.trim()}extractActionItems(t){let e=t.match(/##\s*(?:Action Items|액션 아이템|할 일)\s*\n([\s\S]*?)(?=\n##|$)/i);if(!e)return;let i=e[1].split(`
`).filter(o=>o.match(/^[-*]\s*\[[ x]\]|^[-*]\s+/)).map(o=>o.replace(/^[-*]\s*\[[ x]\]\s*|^[-*]\s+/,"").trim()).filter(o=>o.length>0);return i.length>0?i:void 0}extractDecisions(t){let e=t.match(/##\s*(?:Decisions|결정 사항|결정)\s*\n([\s\S]*?)(?=\n##|$)/i);if(!e)return;let i=e[1].split(`
`).filter(o=>o.match(/^[-*]\s+/)).map(o=>o.replace(/^[-*]\s+/,"").trim()).filter(o=>o.length>0);return i.length>0?i:void 0}};var C=class{constructor(t){this.plugin=t}render(t){let e=this.plugin.settings.defaultTemplate,i=this.getTemplateContent(e);return this.substituteVariables(i,t)}renderWithTemplate(t,e){let i=this.getTemplateContent(t);return this.substituteVariables(i,e)}getTemplateContent(t){let e=d[t];if(e)return e.content;let i=this.plugin.settings.customTemplates[t];return i?i.content:d["meeting-notes"].content}substituteVariables(t,e){let i=t;i=i.replace(/\{\{date\}\}/g,e.date),i=i.replace(/\{\{time\}\}/g,e.time),i=i.replace(/\{\{datetime\}\}/g,e.datetime),i=i.replace(/\{\{title\}\}/g,e.title),i=i.replace(/\{\{duration\}\}/g,e.duration),i=i.replace(/\{\{audioPath\}\}/g,e.audioPath),i=i.replace(/\{\{transcriptPath\}\}/g,e.transcriptPath),i=i.replace(/\{\{speakerCount\}\}/g,String(e.speakerCount)),i=i.replace(/\{\{language\}\}/g,e.language),i=i.replace(/\{\{content\}\}/g,e.content),e.summary&&(i=i.replace(/\{\{summary\}\}/g,e.summary));for(let[o,n]of Object.entries(e.customFields)){let s=new RegExp(`\\{\\{customFields\\.${o}\\}\\}`,"g");i=i.replace(s,n)}return i=i.replace(/\{\{[^}]+\}\}/g,""),i}getAvailableTemplates(){let t=[];for(let[e,i]of Object.entries(d))t.push({id:e,name:i.name,description:i.description});for(let[e,i]of Object.entries(this.plugin.settings.customTemplates))t.push({id:e,name:i.name,description:i.description});return t}};var E=class{constructor(t){this.timerInterval=null;this.plugin=t,this.recorder=new x,this.transcriptionService=new I(t),this.aiFormatter=new k(t),this.templateEngine=new C(t),this.state=this.getInitialState()}getInitialState(){return{status:"idle",startTime:null,duration:0,audioBlob:null,audioPath:null,error:null}}async startRecording(){if(this.state.status==="recording")throw new Error("Recording already in progress");await this.recorder.start(),this.state={...this.getInitialState(),status:"recording",startTime:Date.now()},this.startTimer(),this.plugin.ribbonIcon.setRecording(!0),this.plugin.notify("Recording started")}async stopRecording(){if(this.state.status!=="recording")throw new Error("No recording in progress");this.stopTimer(),this.plugin.ribbonIcon.setRecording(!1),this.plugin.statusBar.hide();let t=await this.recorder.stop();this.state.audioBlob=t,this.state.status="processing",this.plugin.notify("Processing recording...");try{await this.processRecording(t)}catch(e){throw this.state.status="error",this.state.error=e instanceof Error?e.message:"Unknown error",e}}async uploadAudio(){let t=document.createElement("input");return t.type="file",t.accept="audio/*",new Promise((e,i)=>{t.onchange=async()=>{var n;let o=(n=t.files)==null?void 0:n[0];if(!o){i(new Error("No file selected"));return}if(!o.type.startsWith("audio/")){i(new Error("Please select an audio file"));return}this.plugin.notify("Processing uploaded file...");try{await this.processRecording(o),e()}catch(s){i(s)}},t.click()})}isRecording(){return this.state.status==="recording"}getState(){return{...this.state}}async processRecording(t){let e=await this.saveAudioFile(t);this.state.audioPath=e,this.state.status="transcribing",this.plugin.notify("Transcribing audio...");let i=await this.transcriptionService.transcribe(e),o,n=null;this.plugin.settings.autoFormat?(this.state.status="formatting",this.plugin.notify("Formatting with AI..."),n=await this.aiFormatter.format(i.text,this.plugin.settings.defaultTemplate),o=n.content):o=i.text;let s=this.templateEngine.render({date:this.formatDate(new Date),time:this.formatTime(new Date),datetime:new Date().toISOString(),title:this.generateTitle(i),duration:this.formatDuration(i.duration),audioPath:e,transcriptPath:"",speakerCount:i.speakerCount,language:i.language,content:o,summary:n==null?void 0:n.summary,customFields:{}}),m=await this.saveTranscript(s);this.state.status="complete",this.plugin.notify(`Transcript saved: ${m}`),this.state=this.getInitialState()}async saveAudioFile(t){let e=this.getTimestamp(),i=this.getExtensionFromBlob(t),o=`recording-${e}.${i}`,n=this.plugin.settings.recordingFolder,s=`${n}/${o}`;await this.ensureFolderExists(n);let m=await t.arrayBuffer();return await this.plugin.app.vault.adapter.writeBinary(s,m),s}async saveTranscript(t){let i=`transcript-${this.getTimestamp()}.md`,o=this.plugin.settings.recordingFolder,n=`${o}/${i}`;return await this.ensureFolderExists(o),await this.plugin.app.vault.create(n,t),n}async ensureFolderExists(t){let e=this.plugin.app.vault.adapter;await e.exists(t)||await e.mkdir(t)}startTimer(){this.timerInterval=setInterval(()=>{if(this.state.startTime){this.state.duration=Date.now()-this.state.startTime,this.plugin.statusBar.updateTime(this.state.duration);let t=this.plugin.settings.maxRecordingDuration*60*1e3;this.state.duration>=t&&(this.plugin.notify("Maximum recording duration reached"),this.stopRecording())}},h.statusBarUpdateInterval)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}getTimestamp(){return new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}getExtensionFromBlob(t){let e={"audio/webm":"webm","audio/ogg":"ogg","audio/mp4":"m4a","audio/mpeg":"mp3","audio/wav":"wav"};for(let[i,o]of Object.entries(e))if(t.type.includes(i.split("/")[1]))return o;return"webm"}generateTitle(t){let e=t.text.split(/\s+/).slice(0,5).join(" ");return e.length>50?e.slice(0,47)+"...":e||"Untitled Recording"}formatDate(t){return t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}formatTime(t){return t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}formatDuration(t){let e=Math.floor(t/1e3),i=Math.floor(e/3600),o=Math.floor(e%3600/60),n=e%60;return i>0?`${i}h ${o}m ${n}s`:o>0?`${o}m ${n}s`:`${n}s`}};var L=require("obsidian");var D=class{constructor(t){this.isRecordingState=!1;this.plugin=t,this.ribbonEl=t.addRibbonIcon("microphone","VMemo: Start/Stop Recording",()=>this.handleClick()),this.ribbonEl.addClass(h.ribbonIconId)}async handleClick(){this.plugin.recordingManager.isRecording()?await this.plugin.recordingManager.stopRecording():await this.plugin.recordingManager.startRecording()}setRecording(t){this.isRecordingState=t,t?((0,L.setIcon)(this.ribbonEl,"square"),this.ribbonEl.addClass("vmemo-recording"),this.ribbonEl.setAttribute("aria-label","VMemo: Stop Recording")):((0,L.setIcon)(this.ribbonEl,"microphone"),this.ribbonEl.removeClass("vmemo-recording"),this.ribbonEl.setAttribute("aria-label","VMemo: Start Recording"))}isRecording(){return this.isRecordingState}};var V=class{constructor(t){this.plugin=t,this.statusBarEl=t.addStatusBarItem(),this.statusBarEl.addClass(h.statusBarClass),this.hide()}updateTime(t){let e=Math.floor(t/1e3),i=Math.floor(e/60),o=e%60,n=`${i.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`;this.statusBarEl.setText(`\u{1F534} Recording ${n}`),this.show()}updateStatus(t){this.statusBarEl.setText(t),this.show()}show(){this.statusBarEl.style.display="inline-block"}hide(){this.statusBarEl.style.display="none",this.statusBarEl.setText("")}};var l=require("obsidian");var N=class extends l.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h1",{text:"VMemo Settings"}),this.addStorageSettings(t),this.addTranscriptionSettings(t),this.addAISettings(t),this.addTemplateSettings(t),this.addAdvancedSettings(t)}addStorageSettings(t){t.createEl("h2",{text:"Storage"}),new l.Setting(t).setName("Recording folder").setDesc("Folder to save recordings and transcripts").addText(e=>e.setPlaceholder("vmemo-recordings").setValue(this.plugin.settings.recordingFolder).onChange(async i=>{this.plugin.settings.recordingFolder=i||"vmemo-recordings",await this.plugin.saveSettings()})),new l.Setting(t).setName("Keep audio files").setDesc("Keep original audio files after transcription").addToggle(e=>e.setValue(this.plugin.settings.keepAudioFiles).onChange(async i=>{this.plugin.settings.keepAudioFiles=i,await this.plugin.saveSettings()}))}addTranscriptionSettings(t){t.createEl("h2",{text:"Transcription"}),new l.Setting(t).setName("voxmlx path").setDesc("Custom path to voxmlx executable (leave empty for auto-detect)").addText(e=>e.setPlaceholder("Auto-detect").setValue(this.plugin.settings.voxmlxPath).onChange(async i=>{this.plugin.settings.voxmlxPath=i,await this.plugin.saveSettings()})),new l.Setting(t).setName("Language").setDesc("Transcription language (auto for automatic detection)").addDropdown(e=>e.addOption("auto","Auto-detect").addOption("en","English").addOption("ko","Korean").addOption("ja","Japanese").addOption("zh","Chinese").addOption("es","Spanish").addOption("fr","French").addOption("de","German").setValue(this.plugin.settings.transcriptionLanguage).onChange(async i=>{this.plugin.settings.transcriptionLanguage=i,await this.plugin.saveSettings()}))}addAISettings(t){t.createEl("h2",{text:"AI Formatting"}),new l.Setting(t).setName("Auto-format after transcription").setDesc("Automatically format transcripts with AI").addToggle(e=>e.setValue(this.plugin.settings.autoFormat).onChange(async i=>{this.plugin.settings.autoFormat=i,await this.plugin.saveSettings()})),new l.Setting(t).setName("AI Provider").setDesc("Select the AI provider for formatting").addDropdown(e=>{["anthropic","openai","google","xai"].forEach(o=>{e.addOption(o,a[o].name)}),e.setValue(this.plugin.settings.aiProvider).onChange(async o=>{this.plugin.settings.aiProvider=o,await this.plugin.saveSettings()})}),t.createEl("h3",{text:"API Keys"}),new l.Setting(t).setName("Anthropic API Key").setDesc("Your Claude API key").addText(e=>e.setPlaceholder("sk-ant-...").setValue(this.plugin.settings.anthropicKey).onChange(async i=>{this.plugin.settings.anthropicKey=i,await this.plugin.saveSettings()})),new l.Setting(t).setName("Anthropic Model").setDesc("Claude model to use").addText(e=>e.setPlaceholder(a.anthropic.model).setValue(this.plugin.settings.anthropicModel).onChange(async i=>{this.plugin.settings.anthropicModel=i||a.anthropic.model,await this.plugin.saveSettings()})),new l.Setting(t).setName("OpenAI API Key").setDesc("Your OpenAI API key").addText(e=>e.setPlaceholder("sk-...").setValue(this.plugin.settings.openaiKey).onChange(async i=>{this.plugin.settings.openaiKey=i,await this.plugin.saveSettings()})),new l.Setting(t).setName("OpenAI Model").setDesc("GPT model to use").addText(e=>e.setPlaceholder(a.openai.model).setValue(this.plugin.settings.openaiModel).onChange(async i=>{this.plugin.settings.openaiModel=i||a.openai.model,await this.plugin.saveSettings()})),new l.Setting(t).setName("Google API Key").setDesc("Your Google AI API key").addText(e=>e.setPlaceholder("...").setValue(this.plugin.settings.googleKey).onChange(async i=>{this.plugin.settings.googleKey=i,await this.plugin.saveSettings()})),new l.Setting(t).setName("Google Model").setDesc("Gemini model to use").addText(e=>e.setPlaceholder(a.google.model).setValue(this.plugin.settings.googleModel).onChange(async i=>{this.plugin.settings.googleModel=i||a.google.model,await this.plugin.saveSettings()})),new l.Setting(t).setName("xAI API Key").setDesc("Your xAI (Grok) API key").addText(e=>e.setPlaceholder("...").setValue(this.plugin.settings.xaiKey).onChange(async i=>{this.plugin.settings.xaiKey=i,await this.plugin.saveSettings()})),new l.Setting(t).setName("xAI Model").setDesc("Grok model to use").addText(e=>e.setPlaceholder(a.xai.model).setValue(this.plugin.settings.xaiModel).onChange(async i=>{this.plugin.settings.xaiModel=i||a.xai.model,await this.plugin.saveSettings()}))}addTemplateSettings(t){t.createEl("h2",{text:"Templates"}),new l.Setting(t).setName("Default template").setDesc("Template to use for new transcripts").addDropdown(e=>{Object.entries(d).forEach(([i,o])=>{e.addOption(i,o.name)}),Object.keys(this.plugin.settings.customTemplates).forEach(i=>{e.addOption(i,i)}),e.setValue(this.plugin.settings.defaultTemplate).onChange(async i=>{this.plugin.settings.defaultTemplate=i,await this.plugin.saveSettings()})})}addAdvancedSettings(t){t.createEl("h2",{text:"Advanced"}),new l.Setting(t).setName("Maximum recording duration").setDesc("Maximum recording length in minutes (1-480)").addText(e=>e.setPlaceholder("120").setValue(String(this.plugin.settings.maxRecordingDuration)).onChange(async i=>{let o=parseInt(i);!isNaN(o)&&o>=1&&o<=480&&(this.plugin.settings.maxRecordingDuration=o,await this.plugin.saveSettings())})),new l.Setting(t).setName("Show notifications").setDesc("Display notifications for recording events").addToggle(e=>e.setValue(this.plugin.settings.showNotifications).onChange(async i=>{this.plugin.settings.showNotifications=i,await this.plugin.saveSettings()})),new l.Setting(t).setName("Debug mode").setDesc("Enable debug logging").addToggle(e=>e.setValue(this.plugin.settings.debugMode).onChange(async i=>{this.plugin.settings.debugMode=i,await this.plugin.saveSettings()}))}};var F=class extends u.Plugin{constructor(){super(...arguments);this.settings=B}async onload(){await this.loadSettings(),this.recordingManager=new E(this),this.ribbonIcon=new D(this),this.statusBar=new V(this),this.addSettingTab(new N(this.app,this)),this.addCommand({id:"toggle-recording",name:"Start/Stop Recording",callback:()=>this.toggleRecording()}),this.addCommand({id:"start-recording",name:"Start Recording",callback:()=>this.startRecording()}),this.addCommand({id:"stop-recording",name:"Stop Recording",callback:()=>this.stopRecording()}),this.addCommand({id:"upload-audio",name:"Upload Audio File",callback:()=>this.uploadAudio()}),this.settings.debugMode&&console.log("VMemo plugin loaded")}async onunload(){var e;(e=this.recordingManager)!=null&&e.isRecording()&&await this.recordingManager.stopRecording(),this.settings.debugMode&&console.log("VMemo plugin unloaded")}async loadSettings(){let e=await this.loadData();this.settings=Object.assign({},B,e)}async saveSettings(){await this.saveData(this.settings)}async toggleRecording(){this.recordingManager.isRecording()?await this.stopRecording():await this.startRecording()}async startRecording(){try{await this.recordingManager.startRecording()}catch(e){let i=e instanceof Error?e.message:"Unknown error";new u.Notice(`Failed to start recording: ${i}`)}}async stopRecording(){try{await this.recordingManager.stopRecording()}catch(e){let i=e instanceof Error?e.message:"Unknown error";new u.Notice(`Failed to stop recording: ${i}`)}}async uploadAudio(){try{await this.recordingManager.uploadAudio()}catch(e){let i=e instanceof Error?e.message:"Unknown error";new u.Notice(`Failed to upload audio: ${i}`)}}notify(e,i){this.settings.showNotifications&&new u.Notice(e,i)}};
