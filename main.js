/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var K=Object.defineProperty;var tt=Object.getOwnPropertyDescriptor;var et=Object.getOwnPropertyNames;var it=Object.prototype.hasOwnProperty;var ot=(a,i)=>{for(var t in i)K(a,t,{get:i[t],enumerable:!0})},st=(a,i,t,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let o of et(i))!it.call(a,o)&&o!==t&&K(a,o,{get:()=>i[o],enumerable:!(e=tt(i,o))||e.enumerable});return a};var nt=a=>st(K({},"__esModule",{value:!0}),a);var at={};ot(at,{default:()=>_});module.exports=nt(at);var x=require("obsidian");var G={recordingFolder:"vmemo-recordings",keepAudioFiles:!0,audioFormat:"wav",voxmlxPath:"",voxmlxModel:"mlx-community/Voxtral-Mini-4B-6bit",transcriptionLanguage:"auto",aiProvider:"anthropic",autoFormat:!0,anthropicKey:"",anthropicModel:"claude-sonnet-4-20250514",openaiKey:"",openaiModel:"gpt-4.1",googleKey:"",googleModel:"gemini-2.5-pro",xaiKey:"",xaiModel:"grok-3",defaultTemplate:"meeting-notes",customTemplates:{},maxRecordingDuration:120,showNotifications:!0,debugMode:!1},l={anthropic:{model:"claude-sonnet-4-20250514",name:"Claude Sonnet 4",endpoint:"https://api.anthropic.com/v1/messages",maxTokens:8192},openai:{model:"gpt-4.1",name:"GPT-4.1",endpoint:"https://api.openai.com/v1/chat/completions",maxTokens:8192},google:{model:"gemini-2.5-pro",name:"Gemini 2.5 Pro",endpoint:"https://generativelanguage.googleapis.com/v1beta/models",maxTokens:8192},xai:{model:"grok-3",name:"Grok 3",endpoint:"https://api.x.ai/v1/chat/completions",maxTokens:8192}},j={sampleRate:16e3,channelCount:1,bitDepth:16,mimeType:"audio/webm;codecs=opus",targetFormat:"wav",maxFileSizeMB:500},b={voxmlxCommand:"voxmlx",checkCommand:"voxmlx --version",installCommand:"pipx install voxmlx --python python3.11",pythonVersion:"3.11",supportedFormats:["wav","mp3","m4a","flac","ogg","webm"],defaultLanguage:"auto"},p={"meeting-notes":{id:"meeting-notes",name:"Meeting Notes",description:"Structured meeting minutes with action items",icon:"users",content:`# Meeting Notes: {{title}}

**Date**: {{date}}
**Time**: {{time}}
**Duration**: {{duration}}
**Participants**: {{speakerCount}} speakers

---

## Summary

{{summary}}

## Discussion Points

{{content}}

## Action Items

- [ ] 

## Decisions Made

- 

## Next Steps

- 

---

*Recorded with VMemo*
*Audio: [[{{audioPath}}]]*`,systemPrompt:`You are an expert meeting note formatter. Transform the transcript into well-structured meeting notes.

Your responsibilities:
1. Create a concise executive summary (2-3 sentences)
2. Organize discussion points by topic with clear headers
3. Extract and list all action items with assignees if mentioned
4. Identify and document key decisions made
5. Suggest logical next steps based on the discussion
6. Clean up filler words and verbal tics
7. Fix grammar and improve readability

Format with Markdown:
- Use ## for major sections
- Use ### for subsections
- Use bullet points for lists
- Use checkboxes for action items
- Bold important terms and names

Keep the original meaning and tone. Do not add information not present in the transcript.`},"lecture-notes":{id:"lecture-notes",name:"Lecture Notes",description:"Educational content with key concepts and summaries",icon:"graduation-cap",content:`# Lecture: {{title}}

**Date**: {{date}}
**Duration**: {{duration}}
**Subject**: 

---

## Key Concepts

{{summary}}

## Detailed Notes

{{content}}

## Important Terms

- 

## Questions to Review

- 

## Related Topics

- 

---

*Recorded with VMemo*
*Audio: [[{{audioPath}}]]*`,systemPrompt:`You are an expert educational content formatter. Transform the lecture transcript into comprehensive study notes.

Your responsibilities:
1. Identify and highlight key concepts and main ideas
2. Organize content into logical learning sections
3. Extract important terminology and definitions
4. Create review questions based on the content
5. Suggest related topics for further study
6. Clean up verbal fillers and improve readability
7. Preserve technical accuracy and nuance

Format with Markdown:
- Use ## for major topics
- Use ### for subtopics
- Use bullet points for lists
- Use **bold** for key terms
- Use > blockquotes for important quotes or definitions

Optimize for learning and review. Maintain academic rigor.`},interview:{id:"interview",name:"Interview Notes",description:"Q&A format with candidate evaluation",icon:"message-circle",content:`# Interview: {{title}}

**Date**: {{date}}
**Duration**: {{duration}}
**Participants**: {{speakerCount}}

---

## Overview

{{summary}}

## Questions & Answers

{{content}}

## Key Observations

- 

## Strengths

- 

## Areas for Follow-up

- 

## Overall Assessment

---

*Recorded with VMemo*
*Audio: [[{{audioPath}}]]*`,systemPrompt:`You are an expert interview documenter. Transform the interview transcript into structured Q&A notes.

Your responsibilities:
1. Clearly separate questions from answers
2. Identify the interviewer and interviewee
3. Highlight key responses and notable quotes
4. Note any follow-up questions or clarifications
5. Extract observable skills and qualities
6. Maintain objectivity and accuracy
7. Clean up filler words while preserving meaning

Format with Markdown:
- Use **Q:** and **A:** prefixes for dialogue
- Use ### for topic transitions
- Use bullet points for observations
- Use > blockquotes for notable responses

Preserve the authentic voice of the interviewee. Be objective and thorough.`},brainstorm:{id:"brainstorm",name:"Brainstorm Session",description:"Ideas and creative concepts organized by theme",icon:"lightbulb",content:`# Brainstorm: {{title}}

**Date**: {{date}}
**Duration**: {{duration}}
**Participants**: {{speakerCount}}

---

## Session Goal

{{summary}}

## Ideas Generated

{{content}}

## Top Ideas to Explore

1. 
2. 
3. 

## Action Items

- [ ] 

## Parking Lot (Future Ideas)

- 

---

*Recorded with VMemo*
*Audio: [[{{audioPath}}]]*`,systemPrompt:`You are an expert creative session facilitator. Transform the brainstorm transcript into organized idea documentation.

Your responsibilities:
1. Capture ALL ideas mentioned, even incomplete ones
2. Group related ideas by theme or category
3. Identify the most promising or frequently discussed ideas
4. Note any constraints or concerns raised
5. Extract action items for follow-up
6. Preserve creative energy and spontaneity
7. Clean up while maintaining idea essence

Format with Markdown:
- Use ## for idea categories
- Use numbered lists for ranked ideas
- Use bullet points for idea details
- Use \u{1F4A1} emoji for breakthrough ideas
- Use \u26A0\uFE0F for concerns or constraints

Capture the creative spirit. Every idea has potential value.`},journal:{id:"journal",name:"Voice Journal",description:"Personal reflection and daily thoughts",icon:"book-open",content:`# Journal Entry

**Date**: {{date}}
**Time**: {{time}}
**Duration**: {{duration}}

---

## Today's Thoughts

{{content}}

## Reflections

{{summary}}

## Gratitude

- 

## Tomorrow's Intentions

- 

---

*Voice journal powered by VMemo*`,systemPrompt:`You are a thoughtful journal assistant. Transform the voice journal into a reflective written entry.

Your responsibilities:
1. Preserve the personal, authentic voice
2. Organize thoughts into coherent paragraphs
3. Identify themes and patterns in the reflection
4. Extract any goals or intentions mentioned
5. Note any gratitude or positive observations
6. Gently improve readability without losing intimacy
7. Maintain privacy and sensitivity

Format with Markdown:
- Use flowing paragraphs for narrative sections
- Use bullet points for lists
- Use *italics* for inner thoughts
- Use > blockquotes for memorable realizations

This is personal writing. Preserve authenticity and emotional truth.`},raw:{id:"raw",name:"Raw Transcript",description:"Unformatted transcript with minimal cleanup",icon:"file-text",content:`# Transcript: {{title}}

**Date**: {{date}} {{time}}
**Duration**: {{duration}}
**Language**: {{language}}

---

{{content}}

---

*Transcribed with VMemo using voxmlx*
*Audio: [[{{audioPath}}]]*`,systemPrompt:`You are a transcript cleaner. Make minimal improvements to the raw transcript.

Your responsibilities:
1. Add proper punctuation and capitalization
2. Fix obvious speech recognition errors
3. Add paragraph breaks at natural pauses
4. Keep ALL content - do not summarize or remove anything
5. Do not add headers or structure
6. Do not interpret or expand on content

Output the cleaned transcript as continuous text with paragraph breaks.
This should remain as close to verbatim as possible.`}},P={statusBarUpdateInterval:1e3,notificationDuration:5e3,progressUpdateInterval:500,ribbonIconId:"vmemo-ribbon-icon",statusBarClass:"vmemo-status-bar"},I={microphonePermissionDenied:"Microphone access denied. Please allow microphone permission in your browser settings.",noMicrophoneFound:"No microphone found. Please connect an audio input device.",recordingFailed:"Recording failed. Please try again.",maxDurationReached:"Maximum recording duration reached.",voxmlxNotInstalled:"voxmlx is not installed. Would you like to install it now?",voxmlxInstallFailed:"Failed to install voxmlx. Please install manually: pipx install voxmlx --python python3.11",pythonNotFound:"Python 3.11+ not found. Please install Python first.",transcriptionFailed:"Transcription failed. Please check the audio file and try again.",apiKeyMissing:a=>`${a} API key not configured. Please add your API key in settings.`,apiRequestFailed:a=>`${a} API request failed. Please check your API key and try again.`,rateLimitExceeded:"API rate limit exceeded. Please wait a moment and try again.",fileNotFound:"File not found.",fileReadError:"Failed to read file.",fileWriteError:"Failed to write file.",invalidAudioFormat:"Invalid audio format. Supported formats: WAV, MP3, M4A, FLAC, OGG, WebM."};var M=class{constructor(){this.mediaRecorder=null;this.audioChunks=[];this.stream=null}async start(){if(this.mediaRecorder)throw new Error("Recording already in progress");this.stream=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:j.sampleRate,channelCount:j.channelCount,echoCancellation:!0,noiseSuppression:!0}}),this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:this.getSupportedMimeType()}),this.audioChunks=[],this.mediaRecorder.ondataavailable=i=>{i.data.size>0&&this.audioChunks.push(i.data)},this.mediaRecorder.start(1e3)}async stop(){return new Promise((i,t)=>{if(!this.mediaRecorder){t(new Error("No recording in progress"));return}this.mediaRecorder.onstop=()=>{let e=this.getSupportedMimeType(),o=new Blob(this.audioChunks,{type:e});this.cleanup(),i(o)},this.mediaRecorder.onerror=()=>{this.cleanup(),t(new Error("Recording error occurred"))},this.mediaRecorder.stop()})}isRecording(){var i;return((i=this.mediaRecorder)==null?void 0:i.state)==="recording"}getSupportedMimeType(){let i=["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/mp4"];for(let t of i)if(MediaRecorder.isTypeSupported(t))return t;return"audio/webm"}cleanup(){this.stream&&(this.stream.getTracks().forEach(i=>i.stop()),this.stream=null),this.mediaRecorder=null,this.audioChunks=[]}};var z=require("child_process"),W=require("util"),J=require("obsidian");var H=require("child_process"),Y=require("util"),k=require("obsidian");var A=(0,Y.promisify)(H.exec),C=class{constructor(i){this.plugin=i}async checkInstallation(){try{let i=this.plugin.settings.voxmlxPath||b.voxmlxCommand;return await A(`${i} --version`),!0}catch(i){return!1}}async install(){new k.Notice("Installing voxmlx... This may take a few minutes.");try{let i=await this.findPython();await this.installVoxmlx(i),new k.Notice("voxmlx installed successfully!")}catch(i){let t=i instanceof Error?i.message:I.voxmlxInstallFailed;throw new k.Notice(`Installation failed: ${t}`,1e4),i}}async findPython(){let i=["/opt/homebrew/bin/python3","/usr/local/bin/python3","/usr/bin/python3","python3","python"];for(let t of i)try{let{stdout:e}=await A(`${t} --version`),o=e.match(/Python (\d+)\.(\d+)/);if(o){let s=parseInt(o[1]),n=parseInt(o[2]);if(s>=3&&n>=8)return t}}catch(e){continue}throw new Error("Python 3.8+ is required. Please install Python from python.org")}async installVoxmlx(i){let t=[`${i} -m pip install voxmlx --user`,`${i} -m pip install voxmlx`,"/opt/homebrew/bin/pip3 install voxmlx","/usr/local/bin/pip3 install voxmlx"],e=null;for(let o of t)try{if(console.log("VMemo: Trying install command:",o),await A(o,{timeout:3e5}),await new Promise(n=>setTimeout(n,1e3)),await this.checkInstallation()){console.log("VMemo: voxmlx installed successfully");return}}catch(s){e=s instanceof Error?s:new Error(String(s)),console.log("VMemo: Install command failed:",o,e.message);continue}throw new Error(`Failed to install voxmlx. Please run manually:
${t[0]}`)}async getVersion(){try{let i=this.plugin.settings.voxmlxPath||b.voxmlxCommand,{stdout:t}=await A(`${i} --version`);return t.trim()}catch(i){return null}}};var rt=(0,W.promisify)(z.exec),E=class{constructor(i){this.plugin=i,this.installer=new C(i)}async transcribe(i){var o;await this.ensureVoxmlxInstalled();let t=this.getAbsolutePath(i),e=Date.now();try{let s=await this.runVoxmlx(t),n=Date.now()-e;return{text:s.text,duration:s.duration||0,language:s.language||"unknown",speakerCount:((o=s.speakers)==null?void 0:o.length)||1,segments:s.segments||[],metadata:{model:this.plugin.settings.voxmlxModel,processingTime:n,audioPath:i,timestamp:new Date}}}catch(s){let n=s instanceof Error?s.message:"Unknown error";throw new Error(`Transcription failed: ${n}`)}}async ensureVoxmlxInstalled(){await this.installer.checkInstallation()||(new J.Notice("voxmlx not found. Attempting to install..."),await this.installer.install())}getAbsolutePath(i){var e,o;return`${((o=(e=this.plugin.app.vault.adapter).getBasePath)==null?void 0:o.call(e))||""}/${i}`}async runVoxmlx(i){let e=`${this.plugin.settings.voxmlxPath||b.voxmlxCommand} --audio "${i}"`;try{let{stdout:o,stderr:s}=await rt(e,{timeout:6e5,maxBuffer:52428800});return s&&!s.includes("Loading")&&!s.includes("Processing")&&console.warn("voxmlx stderr:",s),this.parseOutput(o)}catch(o){throw o instanceof Error&&o.message.includes("ETIMEDOUT")?new Error("Transcription timed out. The audio file may be too long."):o}}parseOutput(i){try{return JSON.parse(i)}catch(t){return{text:i.trim(),duration:0,language:"unknown",segments:[]}}}};var d=class{constructor(i){this.maxRetries=3;this.retryDelayMs=1e3;this.plugin=i}async withRetry(i,t=1){try{return await i()}catch(e){if(t>=this.maxRetries)throw e;let o=this.retryDelayMs*Math.pow(2,t-1);return await this.sleep(o),this.withRetry(i,t+1)}}sleep(i){return new Promise(t=>setTimeout(t,i))}handleApiError(i,t){var s;let e=t,o=((s=e.error)==null?void 0:s.message)||e.message||"Unknown API error";throw i.status===401?new Error("Invalid API key"):i.status===429?new Error("Rate limit exceeded. Please try again later."):i.status>=500?new Error("Provider server error. Please try again."):new Error(`API Error: ${o}`)}};var R=class extends d{get providerType(){return"anthropic"}isConfigured(){return!!this.plugin.settings.anthropicKey}async complete(i){return this.withRetry(async()=>{var n,m;let t=this.plugin.settings.anthropicModel||l.anthropic.model,e=i.maxTokens||l.anthropic.maxTokens,o=await fetch(l.anthropic.endpoint,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.plugin.settings.anthropicKey,"anthropic-version":"2024-01-01"},body:JSON.stringify({model:t,max_tokens:e,system:i.systemPrompt,messages:[{role:"user",content:i.userPrompt}]})}),s=await o.json();return o.ok||this.handleApiError(o,s),{content:s.content[0].text,model:s.model,usage:{inputTokens:((n=s.usage)==null?void 0:n.input_tokens)||0,outputTokens:((m=s.usage)==null?void 0:m.output_tokens)||0}}})}};var D=class extends d{get providerType(){return"openai"}isConfigured(){return!!this.plugin.settings.openaiKey}async complete(i){return this.withRetry(async()=>{var n,m;let t=this.plugin.settings.openaiModel||l.openai.model,e=i.maxTokens||l.openai.maxTokens,o=await fetch(l.openai.endpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.plugin.settings.openaiKey}`},body:JSON.stringify({model:t,max_tokens:e,messages:[{role:"system",content:i.systemPrompt},{role:"user",content:i.userPrompt}]})}),s=await o.json();return o.ok||this.handleApiError(o,s),{content:s.choices[0].message.content,model:s.model,usage:{inputTokens:((n=s.usage)==null?void 0:n.prompt_tokens)||0,outputTokens:((m=s.usage)==null?void 0:m.completion_tokens)||0}}})}};var V=class extends d{get providerType(){return"google"}isConfigured(){return!!this.plugin.settings.googleKey}async complete(i){return this.withRetry(async()=>{var c,w,y,g,h,u,v;let t=this.plugin.settings.googleModel||l.google.model,e=i.maxTokens||l.google.maxTokens,o=`${l.google.endpoint}/${t}:generateContent?key=${this.plugin.settings.googleKey}`,s=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({system_instruction:{parts:[{text:i.systemPrompt}]},contents:[{parts:[{text:i.userPrompt}]}],generationConfig:{maxOutputTokens:e}})}),n=await s.json();return s.ok||this.handleApiError(s,n),{content:((h=(g=(y=(w=(c=n.candidates)==null?void 0:c[0])==null?void 0:w.content)==null?void 0:y.parts)==null?void 0:g[0])==null?void 0:h.text)||"",model:t,usage:{inputTokens:((u=n.usageMetadata)==null?void 0:u.promptTokenCount)||0,outputTokens:((v=n.usageMetadata)==null?void 0:v.candidatesTokenCount)||0}}})}};var N=class extends d{get providerType(){return"xai"}isConfigured(){return!!this.plugin.settings.xaiKey}async complete(i){return this.withRetry(async()=>{var n,m;let t=this.plugin.settings.xaiModel||l.xai.model,e=i.maxTokens||l.xai.maxTokens,o=await fetch(l.xai.endpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.plugin.settings.xaiKey}`},body:JSON.stringify({model:t,max_tokens:e,messages:[{role:"system",content:i.systemPrompt},{role:"user",content:i.userPrompt}]})}),s=await o.json();return o.ok||this.handleApiError(o,s),{content:s.choices[0].message.content,model:s.model,usage:{inputTokens:((n=s.usage)==null?void 0:n.prompt_tokens)||0,outputTokens:((m=s.usage)==null?void 0:m.completion_tokens)||0}}})}};var O=class{constructor(i){this.plugin=i,this.providers=new Map([["anthropic",new R(i)],["openai",new D(i)],["google",new V(i)],["xai",new N(i)]])}async format(i,t){var y,g;let e=this.getActiveProvider(),o=this.getTemplate(t),s=Date.now(),n=await e.complete({systemPrompt:o.systemPrompt,userPrompt:this.buildUserPrompt(i,t)}),m=this.extractSummary(n.content),c=this.extractActionItems(n.content),w=this.extractDecisions(n.content);return{content:n.content,title:this.generateTitle(n.content),summary:m,actionItems:c,decisions:w,metadata:{provider:e.providerType,model:n.model,template:t,tokensUsed:(((y=n.usage)==null?void 0:y.inputTokens)||0)+(((g=n.usage)==null?void 0:g.outputTokens)||0),processingTime:Date.now()-s}}}getActiveProvider(){let i=this.plugin.settings.aiProvider,t=this.providers.get(i);if(!t)throw new Error(`Unknown provider: ${i}`);if(!t.isConfigured())throw new Error(I.apiKeyMissing(i));return t}getTemplate(i){let t=p[i];if(t)return{systemPrompt:t.systemPrompt,content:t.content};let e=this.plugin.settings.customTemplates[i];return e?{systemPrompt:e.systemPrompt||p["meeting-notes"].systemPrompt,content:e.content}:{systemPrompt:p["meeting-notes"].systemPrompt,content:p["meeting-notes"].content}}buildUserPrompt(i,t){let e=p[t];return`Please format the following voice transcript into a well-structured ${(e==null?void 0:e.name)||"document"}:

---
TRANSCRIPT:
${i}
---

Remember to:
- Clean up filler words (um, uh, like, you know)
- Fix grammar and punctuation
- Add logical section headers
- Extract action items and decisions if applicable
- Maintain the original meaning and important details`}generateTitle(i){let t=i.split(`
`).find(o=>o.trim().startsWith("#"));if(t)return t.replace(/^#+\s*/,"").slice(0,100);let e=i.split(/[.!?]/)[0];return e&&e.length<=100?e.trim():"Untitled Document"}extractSummary(i){var e;let t=i.match(/##\s*(?:Summary|Overview|요약)\s*\n([\s\S]*?)(?=\n##|$)/i);return(e=t==null?void 0:t[1])==null?void 0:e.trim()}extractActionItems(i){let t=i.match(/##\s*(?:Action Items|액션 아이템|할 일)\s*\n([\s\S]*?)(?=\n##|$)/i);if(!t)return;let e=t[1].split(`
`).filter(o=>o.match(/^[-*]\s*\[[ x]\]|^[-*]\s+/)).map(o=>o.replace(/^[-*]\s*\[[ x]\]\s*|^[-*]\s+/,"").trim()).filter(o=>o.length>0);return e.length>0?e:void 0}extractDecisions(i){let t=i.match(/##\s*(?:Decisions|결정 사항|결정)\s*\n([\s\S]*?)(?=\n##|$)/i);if(!t)return;let e=t[1].split(`
`).filter(o=>o.match(/^[-*]\s+/)).map(o=>o.replace(/^[-*]\s+/,"").trim()).filter(o=>o.length>0);return e.length>0?e:void 0}};var F=class{constructor(i){this.plugin=i}render(i){let t=this.plugin.settings.defaultTemplate,e=this.getTemplateContent(t);return this.substituteVariables(e,i)}renderWithTemplate(i,t){let e=this.getTemplateContent(i);return this.substituteVariables(e,t)}getTemplateContent(i){let t=p[i];if(t)return t.content;let e=this.plugin.settings.customTemplates[i];return e?e.content:p["meeting-notes"].content}substituteVariables(i,t){let e=i;e=e.replace(/\{\{date\}\}/g,t.date),e=e.replace(/\{\{time\}\}/g,t.time),e=e.replace(/\{\{datetime\}\}/g,t.datetime),e=e.replace(/\{\{title\}\}/g,t.title),e=e.replace(/\{\{duration\}\}/g,t.duration),e=e.replace(/\{\{audioPath\}\}/g,t.audioPath),e=e.replace(/\{\{transcriptPath\}\}/g,t.transcriptPath),e=e.replace(/\{\{speakerCount\}\}/g,String(t.speakerCount)),e=e.replace(/\{\{language\}\}/g,t.language),e=e.replace(/\{\{content\}\}/g,t.content),t.summary&&(e=e.replace(/\{\{summary\}\}/g,t.summary));for(let[o,s]of Object.entries(t.customFields)){let n=new RegExp(`\\{\\{customFields\\.${o}\\}\\}`,"g");e=e.replace(n,s)}return e=e.replace(/\{\{[^}]+\}\}/g,""),e}getAvailableTemplates(){let i=[];for(let[t,e]of Object.entries(p))i.push({id:t,name:e.name,description:e.description});for(let[t,e]of Object.entries(this.plugin.settings.customTemplates))i.push({id:t,name:e.name,description:e.description});return i}};var Q=require("obsidian"),S=class extends Q.Modal{constructor(t){super(t);this.stage="saving";this.message="";this.errorMessage=""}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("vmemo-processing-modal"),this.modalContent=t.createDiv({cls:"vmemo-modal-container"}),this.iconEl=this.modalContent.createDiv({cls:"vmemo-modal-icon"}),this.stageTitleEl=this.modalContent.createEl("h2",{cls:"vmemo-modal-title"}),this.messageEl=this.modalContent.createDiv({cls:"vmemo-modal-message"}),this.progressEl=this.modalContent.createDiv({cls:"vmemo-modal-progress"}),this.buttonContainerEl=this.modalContent.createDiv({cls:"vmemo-modal-buttons"}),this.updateDisplay()}onClose(){let{contentEl:t}=this;t.empty()}setStage(t,e){this.stage=t,e&&(this.message=e),this.updateDisplay()}setError(t){this.stage="error",this.errorMessage=t,this.updateDisplay()}updateDisplay(){if(!this.modalContent)return;let t=this.getStageConfig();if(this.iconEl.empty(),this.iconEl.setText(t.icon),this.iconEl.className=`vmemo-modal-icon ${t.iconClass}`,this.stageTitleEl.setText(t.title),this.messageEl.setText(t.message),t.showProgress?(this.progressEl.style.display="block",this.progressEl.innerHTML='<div class="vmemo-progress-bar"><div class="vmemo-progress-bar-fill vmemo-progress-animated"></div></div>'):this.progressEl.style.display="none",this.buttonContainerEl.empty(),this.stage==="complete"||this.stage==="error"){let e=this.buttonContainerEl.createEl("button",{text:"Close",cls:"vmemo-btn"});e.onclick=()=>this.close()}}getStageConfig(){switch(this.stage){case"saving":return{icon:"\u{1F4BE}",iconClass:"saving",title:"Saving Audio",message:this.message||"Saving recording to vault...",showProgress:!0};case"transcribing":return{icon:"\u{1F399}\uFE0F",iconClass:"transcribing",title:"Transcribing",message:this.message||"Converting speech to text with voxmlx...",showProgress:!0};case"formatting":return{icon:"\u{1F916}",iconClass:"formatting",title:"AI Formatting",message:this.message||"Formatting transcript with AI...",showProgress:!0};case"complete":return{icon:"\u2705",iconClass:"complete",title:"Complete!",message:this.message||"Your transcript has been saved.",showProgress:!1};case"error":return{icon:"\u274C",iconClass:"error",title:"Error",message:this.errorMessage||"An error occurred.",showProgress:!1};default:return{icon:"\u23F3",iconClass:"",title:"Processing",message:"Please wait...",showProgress:!0}}}};var $=class{constructor(i){this.timerInterval=null;this.modal=null;this.plugin=i,this.recorder=new M,this.transcriptionService=new E(i),this.aiFormatter=new O(i),this.templateEngine=new F(i),this.state=this.getInitialState()}getInitialState(){return{status:"idle",startTime:null,duration:0,audioBlob:null,audioPath:null,error:null}}async startRecording(){if(this.state.status==="recording")throw new Error("Recording already in progress");await this.recorder.start(),this.state={...this.getInitialState(),status:"recording",startTime:Date.now()},this.startTimer(),this.plugin.ribbonIcon.setRecording(!0),this.plugin.statusBar.updateStatus("\u{1F534} Recording..."),this.plugin.notify("Recording started - click mic icon to stop")}async stopRecording(){if(this.state.status!=="recording")throw new Error("No recording in progress");this.stopTimer(),this.plugin.ribbonIcon.setRecording(!1),this.plugin.statusBar.hide(),this.modal=new S(this.plugin.app),this.modal.open(),this.modal.setStage("saving","Saving audio file...");let i=await this.recorder.stop();this.state.audioBlob=i,this.state.status="processing";try{await this.processRecording(i)}catch(t){throw this.state.status="error",this.state.error=t instanceof Error?t.message:"Unknown error",this.modal&&this.modal.setError(this.state.error),t}}async uploadAudio(){let i=document.createElement("input");return i.type="file",i.accept="audio/*",new Promise((t,e)=>{i.onchange=async()=>{var s;let o=(s=i.files)==null?void 0:s[0];if(!o){e(new Error("No file selected"));return}if(!o.type.startsWith("audio/")){e(new Error("Please select an audio file"));return}this.modal=new S(this.plugin.app),this.modal.open(),this.modal.setStage("saving","Processing uploaded file...");try{await this.processRecording(o),t()}catch(n){this.modal&&this.modal.setError(n instanceof Error?n.message:"Unknown error"),e(n)}},i.click()})}isRecording(){return this.state.status==="recording"}getState(){return{...this.state}}async processRecording(i){let t=await this.saveAudioFile(i);this.state.audioPath=t,this.state.status="transcribing",this.modal&&this.modal.setStage("transcribing","Converting speech to text with voxmlx...");let e=await this.transcriptionService.transcribe(t),o,s=null;this.plugin.settings.autoFormat?(this.state.status="formatting",this.modal&&this.modal.setStage("formatting","Formatting transcript with AI..."),s=await this.aiFormatter.format(e.text,this.plugin.settings.defaultTemplate),o=s.content):o=e.text;let n=this.templateEngine.render({date:this.formatDate(new Date),time:this.formatTime(new Date),datetime:new Date().toISOString(),title:this.generateTitle(e),duration:this.formatDuration(e.duration),audioPath:t,transcriptPath:"",speakerCount:e.speakerCount,language:e.language,content:o,summary:s==null?void 0:s.summary,customFields:{}}),m=await this.saveTranscript(n);this.state.status="complete",this.modal&&this.modal.setStage("complete",`Saved to ${m}`),this.plugin.notify(`Transcript saved: ${m}`),this.state=this.getInitialState()}async saveAudioFile(i){let t=this.getTimestamp(),e=this.getExtensionFromBlob(i),o=`recording-${t}.${e}`,s=this.plugin.settings.recordingFolder,n=`${s}/${o}`;await this.ensureFolderExists(s);let m=await i.arrayBuffer();return await this.plugin.app.vault.adapter.writeBinary(n,m),n}async saveTranscript(i){let e=`transcript-${this.getTimestamp()}.md`,o=this.plugin.settings.recordingFolder,s=`${o}/${e}`;return await this.ensureFolderExists(o),await this.plugin.app.vault.create(s,i),s}async ensureFolderExists(i){let t=this.plugin.app.vault.adapter;await t.exists(i)||await t.mkdir(i)}startTimer(){this.timerInterval=setInterval(()=>{if(this.state.startTime){this.state.duration=Date.now()-this.state.startTime,this.plugin.statusBar.updateTime(this.state.duration);let i=this.plugin.settings.maxRecordingDuration*60*1e3;this.state.duration>=i&&(this.plugin.notify("Maximum recording duration reached"),this.stopRecording())}},P.statusBarUpdateInterval)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}getTimestamp(){return new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}getExtensionFromBlob(i){let t={"audio/webm":"webm","audio/ogg":"ogg","audio/mp4":"m4a","audio/mpeg":"mp3","audio/wav":"wav"};for(let[e,o]of Object.entries(t))if(i.type.includes(e.split("/")[1]))return o;return"webm"}generateTitle(i){let t=i.text.split(/\s+/).slice(0,5).join(" ");return t.length>50?t.slice(0,47)+"...":t||"Untitled Recording"}formatDate(i){return i.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}formatTime(i){return i.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}formatDuration(i){let t=Math.floor(i/1e3),e=Math.floor(t/3600),o=Math.floor(t%3600/60),s=t%60;return e>0?`${e}h ${o}m ${s}s`:o>0?`${o}m ${s}s`:`${s}s`}};var q=require("obsidian");var B=class{constructor(i){this.isRecordingState=!1;this.plugin=i,this.ribbonEl=i.addRibbonIcon("microphone","VMemo: Start/Stop Recording",()=>this.handleClick()),this.ribbonEl.addClass(P.ribbonIconId)}async handleClick(){this.plugin.recordingManager.isRecording()?await this.plugin.recordingManager.stopRecording():await this.plugin.recordingManager.startRecording()}setRecording(i){this.isRecordingState=i,i?((0,q.setIcon)(this.ribbonEl,"square"),this.ribbonEl.addClass("vmemo-recording"),this.ribbonEl.setAttribute("aria-label","VMemo: Stop Recording")):((0,q.setIcon)(this.ribbonEl,"microphone"),this.ribbonEl.removeClass("vmemo-recording"),this.ribbonEl.setAttribute("aria-label","VMemo: Start Recording"))}isRecording(){return this.isRecordingState}};var U=class{constructor(i){this.plugin=i,this.statusBarEl=i.addStatusBarItem(),this.statusBarEl.addClass(P.statusBarClass),this.hide()}updateTime(i){let t=Math.floor(i/1e3),e=Math.floor(t/60),o=t%60,s=`${e.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`;this.statusBarEl.setText(`\u{1F534} Recording ${s}`),this.show()}updateStatus(i){this.statusBarEl.setText(i),this.show()}show(){this.statusBarEl.style.display="inline-block"}hide(){this.statusBarEl.style.display="none",this.statusBarEl.setText("")}};var r=require("obsidian"),X=require("child_process"),Z=require("util");var T=(0,Z.promisify)(X.exec),L=class extends r.PluginSettingTab{constructor(t,e){super(t,e);this.voxmlxStatusEl=null;this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h1",{text:"VMemo Settings"}),this.addVoxmlxSection(t),this.addStorageSettings(t),this.addTranscriptionSettings(t),this.addAISettings(t),this.addTemplateSettings(t),this.addAdvancedSettings(t)}async addVoxmlxSection(t){t.createEl("h2",{text:"Transcription Engine (voxmlx)"});let e=t.createDiv({cls:"vmemo-voxmlx-status"});this.voxmlxStatusEl=e.createDiv({cls:"vmemo-status-text"}),await this.checkVoxmlxStatus();let o="pipx install voxmlx";new r.Setting(t).setName("Install voxmlx").setDesc("Opens Terminal and copies install command to clipboard").addButton(m=>m.setButtonText("Open Terminal").setCta().onClick(async()=>{await navigator.clipboard.writeText(o),new r.Notice("Command copied! Paste (\u2318V) in Terminal and press Enter.",5e3),await T("open -a Terminal")})).addButton(m=>m.setButtonText("Check Status").onClick(async()=>{await this.checkVoxmlxStatus(),new r.Notice(await this.verifyVoxmlxInstalled()?"voxmlx is installed!":"voxmlx not found")}));let s=t.createDiv({cls:"vmemo-manual-install"});s.createEl("p",{text:"Requirements: macOS with Apple Silicon (M1/M2/M3/M4)",cls:"vmemo-manual-label"}),s.createEl("p",{text:"Install command:",cls:"vmemo-manual-label"}),s.createEl("code",{text:o,cls:"vmemo-manual-command"});let n=s.createEl("button",{text:"Copy",cls:"vmemo-copy-btn"});n.onclick=()=>{navigator.clipboard.writeText(o),new r.Notice("Copied!"),n.textContent="Copied!",setTimeout(()=>n.textContent="Copy",2e3)},s.createEl("p",{text:"If pipx is not installed: brew install pipx",cls:"vmemo-manual-label vmemo-hint"})}async checkVoxmlxStatus(){var o;if(!this.voxmlxStatusEl)return;let t=["voxmlx --version","~/.local/bin/voxmlx --version","/opt/homebrew/bin/voxmlx --version"];for(let s of t)try{let{stdout:n}=await T(s);this.voxmlxStatusEl.innerHTML=`<span class="vmemo-status-ok">\u2705 Installed</span> <span class="vmemo-version">(${n.trim()})</span>`;return}catch(n){continue}let e=await this.checkSystemRequirements();e.ok?this.voxmlxStatusEl.innerHTML='<span class="vmemo-status-error">\u274C Not installed</span>':this.voxmlxStatusEl.innerHTML=`<span class="vmemo-status-error">\u274C ${((o=e.error)==null?void 0:o.split(`
`)[0])||"System requirements not met"}</span>`}async installVoxmlx(){let t=await this.checkSystemRequirements();if(!t.ok)throw new Error(t.error);new r.Notice("Installing voxmlx... This may take 1-2 minutes.");let e=t.pythonPath,s=`/opt/homebrew/bin:/usr/local/bin:${process.env.HOME||"/Users/"+process.env.USER}/.local/bin:/usr/bin:/bin`,n={timeout:3e5,env:{...process.env,PATH:s}},m=[{cmd:"/opt/homebrew/bin/pipx install voxmlx",desc:"pipx (homebrew)"},{cmd:`${e} -m pip install voxmlx --user --break-system-packages`,desc:"pip (break-system)"},{cmd:`${e} -m pip install voxmlx --break-system-packages`,desc:"pip (system)"}],c=[];for(let{cmd:h,desc:u}of m)try{if(console.log(`VMemo: Trying ${u}: ${h}`),await T(h,n),await new Promise(v=>setTimeout(v,2e3)),await this.verifyVoxmlxInstalled()){new r.Notice("voxmlx installed successfully!");return}}catch(v){let f=v instanceof Error?v.message:String(v);console.log(`VMemo: ${u} failed:`,f),f.includes("No matching distribution")||f.includes("from versions: none")?c.push(`${u}: Package not found`):f.includes("externally-managed-environment")?c.push(`${u}: System Python restrictions`):f.includes("command not found")||f.includes("No such file")?c.push(`${u}: Not installed`):c.push(`${u}: ${f.slice(0,80)}`);continue}let w=c.join(`
`),y=c.some(h=>h.includes("pipx")&&h.includes("Not installed")),g=`${e} -m pip install voxmlx --break-system-packages`;throw y&&(g="brew install pipx && pipx install voxmlx"),new Error(`Installation failed.

Requirements:
\u2022 macOS with Apple Silicon (M1/M2/M3/M4)
\u2022 Python 3.10+ (Detected: ${t.version})
\u2022 pipx (recommended)

Run in Terminal:
${g}

Errors:
${w}`)}async checkSystemRequirements(){try{let{stdout:e}=await T("uname -m");if(!e.trim().includes("arm64"))return{ok:!1,pythonPath:"",version:"",error:`voxmlx requires Apple Silicon (M1/M2/M3/M4).
Your Mac appears to be Intel-based.

Alternative: Use cloud transcription services instead.`}}catch(e){}let t=["/opt/homebrew/bin/python3","/opt/homebrew/bin/python3.12","/opt/homebrew/bin/python3.11","/opt/homebrew/bin/python3.10","/usr/local/bin/python3","python3"];for(let e of t)try{let{stdout:o}=await T(`${e} --version`),s=o.match(/Python (\d+)\.(\d+)/);if(s){let n=parseInt(s[1]),m=parseInt(s[2]),c=`${n}.${m}`;if(n>=3&&m>=10)return console.log(`VMemo: Found suitable Python: ${e} (${c})`),{ok:!0,pythonPath:e,version:c};console.log(`VMemo: Python ${c} at ${e} is too old (need >=3.10)`)}}catch(o){continue}return{ok:!1,pythonPath:"",version:"",error:`No suitable Python found.

voxmlx requires Python 3.10 or higher.

Install with Homebrew:
brew install python@3.12

Then try again.`}}async verifyVoxmlxInstalled(){let t=["voxmlx --version","~/.local/bin/voxmlx --version","/opt/homebrew/bin/voxmlx --version"];for(let e of t)try{return await T(e),!0}catch(o){continue}return!1}addStorageSettings(t){t.createEl("h2",{text:"Storage"}),new r.Setting(t).setName("Recording folder").setDesc("Folder to save recordings and transcripts").addText(e=>e.setPlaceholder("vmemo-recordings").setValue(this.plugin.settings.recordingFolder).onChange(async o=>{this.plugin.settings.recordingFolder=o||"vmemo-recordings",await this.plugin.saveSettings()})),new r.Setting(t).setName("Keep audio files").setDesc("Keep original audio files after transcription").addToggle(e=>e.setValue(this.plugin.settings.keepAudioFiles).onChange(async o=>{this.plugin.settings.keepAudioFiles=o,await this.plugin.saveSettings()}))}addTranscriptionSettings(t){t.createEl("h2",{text:"Transcription Options"}),new r.Setting(t).setName("voxmlx path").setDesc("Custom path to voxmlx executable (leave empty for auto-detect)").addText(e=>e.setPlaceholder("Auto-detect").setValue(this.plugin.settings.voxmlxPath).onChange(async o=>{this.plugin.settings.voxmlxPath=o,await this.plugin.saveSettings()})),new r.Setting(t).setName("Language").setDesc("Transcription language (auto for automatic detection)").addDropdown(e=>e.addOption("auto","Auto-detect").addOption("en","English").addOption("ko","Korean").addOption("ja","Japanese").addOption("zh","Chinese").addOption("es","Spanish").addOption("fr","French").addOption("de","German").setValue(this.plugin.settings.transcriptionLanguage).onChange(async o=>{this.plugin.settings.transcriptionLanguage=o,await this.plugin.saveSettings()}))}addAISettings(t){t.createEl("h2",{text:"AI Formatting"}),new r.Setting(t).setName("Auto-format after transcription").setDesc("Automatically format transcripts with AI").addToggle(e=>e.setValue(this.plugin.settings.autoFormat).onChange(async o=>{this.plugin.settings.autoFormat=o,await this.plugin.saveSettings()})),new r.Setting(t).setName("AI Provider").setDesc("Select the AI provider for formatting").addDropdown(e=>{["anthropic","openai","google","xai"].forEach(s=>{e.addOption(s,l[s].name)}),e.setValue(this.plugin.settings.aiProvider).onChange(async s=>{this.plugin.settings.aiProvider=s,await this.plugin.saveSettings()})}),t.createEl("h3",{text:"API Keys"}),new r.Setting(t).setName("Anthropic API Key").setDesc("Your Claude API key").addText(e=>e.setPlaceholder("sk-ant-...").setValue(this.plugin.settings.anthropicKey).onChange(async o=>{this.plugin.settings.anthropicKey=o,await this.plugin.saveSettings()})),new r.Setting(t).setName("Anthropic Model").setDesc("Claude model to use").addText(e=>e.setPlaceholder(l.anthropic.model).setValue(this.plugin.settings.anthropicModel).onChange(async o=>{this.plugin.settings.anthropicModel=o||l.anthropic.model,await this.plugin.saveSettings()})),new r.Setting(t).setName("OpenAI API Key").setDesc("Your OpenAI API key").addText(e=>e.setPlaceholder("sk-...").setValue(this.plugin.settings.openaiKey).onChange(async o=>{this.plugin.settings.openaiKey=o,await this.plugin.saveSettings()})),new r.Setting(t).setName("OpenAI Model").setDesc("GPT model to use").addText(e=>e.setPlaceholder(l.openai.model).setValue(this.plugin.settings.openaiModel).onChange(async o=>{this.plugin.settings.openaiModel=o||l.openai.model,await this.plugin.saveSettings()})),new r.Setting(t).setName("Google API Key").setDesc("Your Google AI API key").addText(e=>e.setPlaceholder("...").setValue(this.plugin.settings.googleKey).onChange(async o=>{this.plugin.settings.googleKey=o,await this.plugin.saveSettings()})),new r.Setting(t).setName("Google Model").setDesc("Gemini model to use").addText(e=>e.setPlaceholder(l.google.model).setValue(this.plugin.settings.googleModel).onChange(async o=>{this.plugin.settings.googleModel=o||l.google.model,await this.plugin.saveSettings()})),new r.Setting(t).setName("xAI API Key").setDesc("Your xAI (Grok) API key").addText(e=>e.setPlaceholder("...").setValue(this.plugin.settings.xaiKey).onChange(async o=>{this.plugin.settings.xaiKey=o,await this.plugin.saveSettings()})),new r.Setting(t).setName("xAI Model").setDesc("Grok model to use").addText(e=>e.setPlaceholder(l.xai.model).setValue(this.plugin.settings.xaiModel).onChange(async o=>{this.plugin.settings.xaiModel=o||l.xai.model,await this.plugin.saveSettings()}))}addTemplateSettings(t){t.createEl("h2",{text:"Templates"}),new r.Setting(t).setName("Default template").setDesc("Template to use for new transcripts").addDropdown(e=>{Object.entries(p).forEach(([o,s])=>{e.addOption(o,s.name)}),Object.keys(this.plugin.settings.customTemplates).forEach(o=>{e.addOption(o,o)}),e.setValue(this.plugin.settings.defaultTemplate).onChange(async o=>{this.plugin.settings.defaultTemplate=o,await this.plugin.saveSettings()})})}addAdvancedSettings(t){t.createEl("h2",{text:"Advanced"}),new r.Setting(t).setName("Maximum recording duration").setDesc("Maximum recording length in minutes (1-480)").addText(e=>e.setPlaceholder("120").setValue(String(this.plugin.settings.maxRecordingDuration)).onChange(async o=>{let s=parseInt(o);!isNaN(s)&&s>=1&&s<=480&&(this.plugin.settings.maxRecordingDuration=s,await this.plugin.saveSettings())})),new r.Setting(t).setName("Show notifications").setDesc("Display notifications for recording events").addToggle(e=>e.setValue(this.plugin.settings.showNotifications).onChange(async o=>{this.plugin.settings.showNotifications=o,await this.plugin.saveSettings()})),new r.Setting(t).setName("Debug mode").setDesc("Enable debug logging").addToggle(e=>e.setValue(this.plugin.settings.debugMode).onChange(async o=>{this.plugin.settings.debugMode=o,await this.plugin.saveSettings()}))}};var _=class extends x.Plugin{constructor(){super(...arguments);this.settings=G}async onload(){await this.loadSettings(),this.recordingManager=new $(this),this.ribbonIcon=new B(this),this.statusBar=new U(this),this.addSettingTab(new L(this.app,this)),this.addCommand({id:"toggle-recording",name:"Start/Stop Recording",callback:()=>this.toggleRecording()}),this.addCommand({id:"start-recording",name:"Start Recording",callback:()=>this.startRecording()}),this.addCommand({id:"stop-recording",name:"Stop Recording",callback:()=>this.stopRecording()}),this.addCommand({id:"upload-audio",name:"Upload Audio File",callback:()=>this.uploadAudio()}),this.settings.debugMode&&console.log("VMemo plugin loaded")}async onunload(){var t;(t=this.recordingManager)!=null&&t.isRecording()&&await this.recordingManager.stopRecording(),this.settings.debugMode&&console.log("VMemo plugin unloaded")}async loadSettings(){let t=await this.loadData();this.settings=Object.assign({},G,t)}async saveSettings(){await this.saveData(this.settings)}async toggleRecording(){this.recordingManager.isRecording()?await this.stopRecording():await this.startRecording()}async startRecording(){try{await this.recordingManager.startRecording()}catch(t){let e=t instanceof Error?t.message:"Unknown error";new x.Notice(`Failed to start recording: ${e}`)}}async stopRecording(){try{await this.recordingManager.stopRecording()}catch(t){let e=t instanceof Error?t.message:"Unknown error";new x.Notice(`Failed to stop recording: ${e}`)}}async uploadAudio(){try{await this.recordingManager.uploadAudio()}catch(t){let e=t instanceof Error?t.message:"Unknown error";new x.Notice(`Failed to upload audio: ${e}`)}}notify(t,e){this.settings.showNotifications&&new x.Notice(t,e)}};
